# 📋 更新日志

## 版本: v1.0.1
**日期**: 2025-11-15

---

## ✨ 新增功能

### 1. 📚 Z-Score分析说明文档
在**CVD曲线分析**页面添加了可展开的详细说明：
- **Z-Score标准化原理**
  - 公式展示: `(当前CVD值 - 均值) / 标准差`
  - 无单位，可比较的特性说明

- **动能解读方法**
  - 零轴上方：资金净流入强于平均水平
  - 零轴下方：资金净流入弱于平均水平

- **关键区域分析**
  - Z-Score > +1：🔴 强势买入动能
  - Z-Score < -1：🟢 强势卖出动能
  - 零轴附近：⚪ 中性状态

- **参考线说明**
  - 灰色实线：零轴（均值线）
  - 红色虚线：+1标准差阈值
  - 绿色虚线：-1标准差阈值

### 2. 🔄 数据更新机制
- **刷新按钮**：页面右上角添加"🔄 刷新数据"按钮
- **手动刷新**：点击按钮可强制清除缓存并重新加载数据
- **自动刷新**：缓存时间从60秒缩短至30秒
- **实时响应**：数据更新更及时

---

## 🎨 界面优化

### 1. 简化CVD曲线分析页面
- **删除关键指标展示区域**
  - 移除最高/最低/平均Z-Score指标卡片
  - 页面更加简洁，聚焦核心图表

### 2. 背离检测页面重新设计
- **移除Z-Score展示**
  - 不再显示Z-Score曲线

- **CVD曲线展示**
  - 右Y轴显示原始CVD值（红色线）
  - 左Y轴显示价格（蓝色线）

- **背离线可视化** (新增)
  - 橙色点线连接所有背离时间点
  - 菱形标记突出显示背离点
  - 直观展示背离趋势

- **背离点详情** (新增)
  - 列出每个背离点的详细信息
  - 包含：时间、价格、CVD值、Z-Score

---

## 🔧 技术改进

### 1. 数据处理增强
- **新增方法**：`DivergenceDetector.get_divergence_points()`
  - 返回背离点的详细信息
  - 包含时间戳、价格、CVD值、Z-Score

- **缓存优化**
  - `@st.cache_data(ttl=30)` 缓存时间缩短
  - 支持手动清除缓存

### 2. 可视化改进
- **双Y轴布局**
  - 价格（左）：蓝色
  - CVD值（右）：红色
  - 背离点：橙色菱形标记

- **交互增强**
  - 悬停提示显示详细信息
  - 图例点击切换显示/隐藏

---

## 📊 测试验证

### 功能测试
- [x] Z-Score说明文档展示正常
- [x] 关键指标区域成功删除
- [x] 背离检测页面显示CVD曲线
- [x] 背离线绘制正确
- [x] 背离点详情展示正确
- [x] 刷新按钮功能正常
- [x] 缓存时间调整有效

### 兼容性测试
- [x] 模块导入正常
- [x] 数据处理正常
- [x] 图表渲染正常
- [x] 交互功能正常

---

## 📦 修改文件

| 文件 | 修改类型 | 说明 |
|------|---------|------|
| `app/main.py` | 修改 | 添加Z-Score说明、删除关键指标、优化背离检测、添加刷新按钮 |
| `data_processor/cvd_analyzer.py` | 修改 | 新增`get_divergence_points()`方法 |
| `config/config.py` | 修改 | 缓存时间从60秒改为30秒 |

---

## 🚀 使用指南

### 如何获取最新更新
```bash
git pull origin main
```

### 如何使用新功能
1. **查看Z-Score说明**：在"CVD曲线分析"页面，点击"📘 关于Z-Score分析"
2. **刷新数据**：点击页面右上角的"🔄 刷新数据"按钮
3. **查看背离线**：在"背离检测"页面，橙色点线即为背离线
4. **查看背离点详情**：背离检测图表下方显示所有背离点信息

---

## 📝 注意事项

1. **缓存机制**：现在数据缓存时间为30秒，如需查看最新数据请点击刷新按钮
2. **背离线**：只有存在多个背离点的标的才会显示背离线
3. **性能**：减少缓存时间可能会增加数据加载频率，影响性能

---

## 🔮 未来计划

- [ ] 添加自动刷新间隔配置
- [ ] 背离点预警通知
- [ ] 导出背离点数据功能
- [ ] 背离强度评分算法
- [ ] 历史背离数据回测

---

**开发团队** | phoe8lin | sirsunlight911@gmail.com | Claude Code
